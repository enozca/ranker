<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ranker — Rankings Visuais</title>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  :root{
    --bg-start: #020617;
    --bg-end: #131b34;
    --card: rgba(21, 28, 51, 0.5);
    --card-border: rgba(255, 255, 255, 0.1);
    --muted: #8c97b3;
    --text: #e2e8f0;
    --accent: #8b5cf6;
    --accent-rgb: 139, 92, 246;
    --secondary: #22d3ee;
    --secondary-rgb: 34, 211, 238;
    --danger: #f43f5e;
    --radius: 12px;
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
    color-scheme: dark;
  }
  @keyframes slideInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

  *{box-sizing:border-box}
  body{
    margin:0; min-height:100vh;
    background-color: var(--bg-start);
    background-image: radial-gradient(circle at 1% 1%, var(--accent), transparent 30%), radial-gradient(circle at 99% 99%, var(--secondary), transparent 35%);
    background-attachment: fixed;
    color: var(--text);
    padding:16px; font-size:14px;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  header{display:flex; flex-direction: column; gap:4px; align-items:center; text-align:center; margin-bottom:24px;}
  h1{
    margin:0;font-size:2.25rem;
    font-weight: 800;
    background: linear-gradient(45deg, var(--text), var(--muted));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  .container{display:grid;grid-template-columns:320px 1fr;gap:20px;}
  .panel{
    background: var(--card);
    border: 1px solid var(--card-border);
    padding:16px;
    border-radius:var(--radius);
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }
  .sidebar .section{margin-bottom:16px}
  label{display:block;color:var(--muted); font-size:12px;margin-bottom:6px; font-weight: 500;}
  input, textarea, select {
    width:100%; padding:10px 12px; border-radius:8px;
    border: 1px solid rgba(255,255,255,0.08);
    background:rgba(0,0,0,0.2); color:inherit; font-size: 14px;
    transition: all 0.2s ease;
  }
  input:focus, textarea:focus, select:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(var(--accent-rgb), 0.3); }
  
  button{
    cursor:pointer; padding:10px 14px; border-radius:8px; border:0;
    font-weight: 600; transition: all 0.2s ease;
    background: linear-gradient(45deg, var(--accent), #a855f7);
    color: white;
    box-shadow: 0 4px 15px -5px rgba(var(--accent-rgb), 0.5);
  }
  button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px -5px rgba(var(--accent-rgb), 0.7); }
  .btn-ghost{
    background: transparent; border:1px solid var(--card-border); color: var(--muted); box-shadow: none;
  }
  .btn-ghost:hover{ background: rgba(255,255,255,0.05); border-color: var(--accent); color: var(--text); }
  .btn-danger{ background: var(--danger); box-shadow: 0 4px 15px -5px rgba(244, 63, 94, 0.5); }
  .btn-danger:hover{ background:#f43f5e; box-shadow: 0 6px 20px -5px rgba(244, 63, 94, 0.7); }
  
  .muted{color:var(--muted);font-size:13px}
  
  /* Rank List & Items */
  .rank-list{display:grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px; margin-top: 16px;}
  .item{
    display: flex; flex-direction: column;
    border-radius: var(--radius);
    background: rgba(255,255,255,0.02);
    border:1px solid rgba(255,255,255,0.05);
    transition: all 0.2s ease-in-out;
    animation: slideInUp 0.5s ease-out forwards;
    opacity: 0; animation-delay: calc(var(--i, 0) * 50ms);
    overflow: hidden;
  }
  .item:hover { transform: translateY(-4px); background: rgba(255,255,255,0.05); border-color: rgba(var(--accent-rgb), 0.5); box-shadow: 0 8px 24px rgba(0,0,0,0.3);}
  
  .item-banner {
    width: 100%; height: 140px; background-size: cover; background-position: center;
    background-color: rgba(255,255,255,0.05); position: relative;
  }
  .item-banner::after {
    content: ''; position: absolute; inset: 0;
    background: linear-gradient(to top, rgba(21, 28, 51, 0.9) 0%, rgba(21, 28, 51, 0) 70%);
  }
  
  .item-content { padding: 12px 14px; display: flex; flex-direction: column; gap: 8px; flex-grow: 1; }
  .item-header { display: flex; justify-content: space-between; align-items: flex-start; }
  .item .name { font-weight: 600; color: var(--text); font-size: 16px; line-height: 1.3; }
  .score-wrapper { text-align: right; }
  .score{
    font-weight:800; font-size: 24px;
    background: linear-gradient(45deg, var(--secondary), var(--accent));
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  }
  .score-votes { color: var(--muted); font-size: 11px; }
  .item .desc { font-size: 13px; color: var(--muted); flex-grow: 1;}
  .item-footer { display: flex; justify-content: space-between; align-items: center; margin-top: auto; }
  .tags{display:flex;gap:4px;flex-wrap:wrap;}
  .tag{
    background: rgba(var(--secondary-rgb), 0.1); color: var(--secondary);
    border: 1px solid rgba(var(--secondary-rgb), 0.2);
    padding:3px 8px; border-radius:999px;font-size:11px; font-weight: 500;
  }
  .controls { display: flex; align-items: center; }
  .controls button { background: none; box-shadow: none; padding: 4px; color: var(--muted); }
  .controls button:hover { background: rgba(var(--accent-rgb), 0.1); color: var(--accent); transform: scale(1.1); }
  .controls svg { width: 16px; height: 16px; }

  /* Edit Form */
  .edit-form { padding: 10px; background: rgba(0,0,0,0.2); border-radius: 8px; }
  .edit-form .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .edit-form label { margin-top: 8px; }

  /* General Layout */
  .list-header{ padding-bottom: 8px; border-bottom: 1px solid var(--card-border); display:flex;justify-content:space-between;align-items:center; flex-wrap: wrap; gap: 8px;}
  #categoryTitle { font-size: 20px; font-weight: 700; }
  .categories-list a { display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; border-radius: 8px; text-decoration: none; color: var(--muted); transition: all 0.2s ease; }
  .categories-list a:hover { background: rgba(255,255,255,0.05); color: var(--text); }
  .categories-list a.active { background: rgba(var(--accent-rgb), 0.15); color: var(--accent); font-weight: 600; }
  .categories-list a .delete-cat { display: none; }
  .categories-list a:hover .delete-cat { display: block; }
  .toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: var(--accent); color: white; padding: 12px 20px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); z-index: 1000; opacity: 0; transition: opacity 0.3s, bottom 0.3s; font-size: 14px; }
  .toast.show { bottom: 30px; opacity: 1; }

  @media (max-width:900px){
    body { padding: 8px; }
    .container{grid-template-columns:1fr}
    .sidebar{order:2}
    .rank-list{grid-template-columns: 1fr;}
  }
</style>
</head>
<body>
<header>
  <h1>Ranker</h1>
  <div class="muted">Crie, compare e compartilhe rankings de qualquer coisa.</div>
</header>

<div class="container">
  <aside class="sidebar panel">
      <div class="section">
        <label for="catName">Nova categoria</label>
        <input id="catName" placeholder="Ex: Filmes, Animes, Pratos..." />
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="createCatBtn">Criar</button>
          <button id="importBtn" class="btn-ghost small">Importar</button>
        </div>
      </div>
      <div class="section">
        <label>Categorias</label>
        <div id="categoriesList" class="categories-list">Carregando...</div>
      </div>
      <hr style="border:none;border-top:1px solid var(--card-border);margin:16px 0" />
      <div class="section">
        <label for="itemName">Adicionar item</label>
        <input id="itemName" placeholder="Nome do item" />
        <label for="itemImageUrl" style="margin-top:6px">URL da Imagem (opcional)</label>
        <input id="itemImageUrl" placeholder="https://exemplo.com/imagem.jpg" />
        <label for="itemDesc" style="margin-top:6px">Descrição (opcional)</label>
        <textarea id="itemDesc" rows="2" placeholder="Breve descrição"></textarea>
        <label style="margin-top:6px">Tags (separadas por vírgula)</label>
        <input id="itemTags" placeholder="ex: clássico, drama" />
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="addItemBtn">Adicionar</button>
        </div>
      </div>
  </aside>

  <main class="panel">
    <div class="list-header">
      <div>
        <strong id="categoryTitle">—</strong>
        <div class="muted" id="categoryCount">0 itens</div>
      </div>
      <div class="flex">
        <button id="showChartBtn" class="small btn-ghost">Gráfico</button>
      </div>
    </div>
    <div id="mainContent">
      <div id="rankList" class="rank-list" aria-live="polite"></div>
      <div id="chartPanel" class="panel hidden" style="margin-top:16px;">
        <h3>Gráfico de pontuações</h3>
        <div class="chart-wrap"><canvas id="scoreChart" height="120"></canvas></div>
        <div style="margin-top:8px"><button id="closeChart" class="small btn-ghost">Fechar gráfico</button></div>
      </div>
    </div>
  </main>
</div>

<input id="fileInput" type="file" accept=".json,.csv,text/csv" class="hidden" />
<div id="toast-container"></div>

<script>
'use strict';
const STORAGE_KEY = 'ranker-data-v3';
const $ = (selector) => document.querySelector(selector);
const Util = {
  uid: (prefix = 'id') => prefix + '_' + Math.random().toString(36).slice(2, 9),
  now: () => new Date().toISOString(),
  escapeHTML: (str) => String(str).replace(/[&<>"']/g, (m) => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' })[m]),
  showToast: (message, duration = 3000) => {
    const container = $('#toast-container');
    const toast = document.createElement('div');
    toast.className = `toast`;
    toast.textContent = message;
    container.appendChild(toast);
    setTimeout(() => { toast.classList.add('show'); }, 10);
    setTimeout(() => {
      toast.classList.remove('show');
      toast.addEventListener('transitionend', () => toast.remove());
    }, duration);
  }
};

const sample = {
  categories: [{ id: 'cat_movies', name: 'Filmes', createdAt: Util.now(), order: 0 }],
  items: [
    { id: Util.uid('it'), cat: 'cat_movies', name: 'Blade Runner 2049', imageUrl: 'https://images.unsplash.com/photo-1588532902250-df0124aa3f83?w=500&q=80', desc:'Um novo blade runner descobre um segredo que ameaça a sociedade.', tags:['sci-fi','cult'], score:9.8, votes:1500, createdAt: Util.now(), customOrder:0 },
    { id: Util.uid('it'), cat: 'cat_movies', name: 'Interestelar', imageUrl: 'https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=500&q=80', desc:'Uma equipe de exploradores viaja através de um buraco de minhoca.', tags:['sci-fi','épico'], score:9.5, votes:1200, createdAt: Util.now(), customOrder:1 },
  ]
};

let state = { categories: [], items: [] };
let currentCategoryId = null;
let editingItemId = null;
let chartInstance = null;

const DOM = {
  categoriesList: $('#categoriesList'), categoryTitle: $('#categoryTitle'), categoryCount: $('#categoryCount'),
  rankList: $('#rankList'),
  createCatBtn: $('#createCatBtn'), catNameInput: $('#catName'),
  itemNameInput: $('#itemName'), itemImageUrlInput: $('#itemImageUrl'), itemDescInput: $('#itemDesc'), itemTagsInput: $('#itemTags'),
  addItemBtn: $('#addItemBtn'),
  showChartBtn: $('#showChartBtn'), chartPanel: $('#chartPanel'), scoreChartCanvas: $('#scoreChart'), closeChart: $('#closeChart'),
};

const AppState = {
  save: () => { try { localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); } catch(e) { console.error("Failed to save state:", e); } },
  load: () => {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      const loadedState = raw ? JSON.parse(raw) : sample;
      state.categories = loadedState.categories || [];
      state.items = loadedState.items || [];
      state.items.forEach(it => { if (it.imageUrl === undefined) it.imageUrl = ''; });
    } catch (e) {
      console.error('Failed to load state, using sample data.', e);
      state = sample;
    }
  }
};

const App = {
  createCategory(name) {
    if (!name) return Util.showToast('Nome da categoria necessário');
    const id = Util.uid('cat');
    state.categories.push({ id, name, createdAt: Util.now(), order: state.categories.length });
    currentCategoryId = id;
    renderCategories();
    Util.showToast(`Categoria "${name}" criada!`);
  },
  deleteCategory(catId) {
    state.items = state.items.filter(it => it.cat !== catId);
    state.categories = state.categories.filter(c => c.id !== catId);
    currentCategoryId = state.categories.length ? state.categories[0].id : null;
    renderCategories();
    Util.showToast('Categoria excluída');
  },
  addItem(catId, name, imageUrl, desc, tags) {
    if (!catId) return Util.showToast('Selecione uma categoria');
    if (!name) return Util.showToast('Nome do item necessário');
    const item = { id: Util.uid('it'), cat: catId, name, imageUrl, desc, tags: App.formatTags(tags), score: 5.0, votes: 0, createdAt: Util.now(), customOrder: App.getItemsForCategory(catId).length };
    state.items.push(item);
    renderMain();
    Util.showToast(`Item "${name}" adicionado.`);
  },
  updateItem(itemId, data) {
    const item = state.items.find(it => it.id === itemId);
    if (!item) return;
    Object.assign(item, data);
    editingItemId = null;
    renderMain();
    Util.showToast('Item atualizado.');
  },
  deleteItem(itemId) {
    state.items = state.items.filter(it => it.id !== itemId);
    renderMain();
    Util.showToast('Item excluído');
  },
  vote(itemId, delta) {
    const item = state.items.find(x => x.id === itemId);
    if (!item) return;
    item.votes = (item.votes || 0) + (delta > 0 ? 1 : (item.votes > 0 ? -1 : 0));
    item.score = Math.max(0, Math.min(10, (item.score || 0) + (delta > 0 ? 0.1 : -0.1)));
    renderMain();
  },
  getItemsForCategory: (catId) => state.items.filter(it => it.cat === catId),
  formatTags: (tags) => (Array.isArray(tags) ? tags : String(tags).split(',')).map(t => t.trim()).filter(Boolean),
};

function renderCategories() {
  DOM.categoriesList.innerHTML = '';
  state.categories.sort((a, b) => (a.order || 0) - (b.order || 0));
  state.categories.forEach(cat => {
    const el = document.createElement('a');
    el.href = '#';
    el.className = `category-link ${cat.id === currentCategoryId ? 'active' : ''}`;
    el.dataset.id = cat.id;
    el.innerHTML = `<span>${Util.escapeHTML(cat.name)}</span><button class="delete-cat btn-ghost" data-action="delete-category" data-id="${cat.id}" aria-label="Excluir">&times;</button>`;
    el.onclick = (e) => { e.preventDefault(); if(e.target.dataset.action === 'delete-category') { if(confirm('Excluir categoria?')) App.deleteCategory(cat.id); } else { currentCategoryId = cat.id; renderCategories(); } };
    DOM.categoriesList.appendChild(el);
  });
  if (!state.categories.length) { DOM.categoriesList.innerHTML = '<div class="muted" style="padding: 8px 12px;">Nenhuma categoria.</div>'; currentCategoryId = null; }
  if (!currentCategoryId && state.categories[0]) { currentCategoryId = state.categories[0].id; }
  renderMain();
}

function createItemHTML(item) {
  if (editingItemId === item.id) {
    return `
      <div class="item edit-form" data-id="${item.id}">
        <div><label>Nome</label><input type="text" id="edit-name-${item.id}" value="${Util.escapeHTML(item.name)}"></div>
        <div><label>URL da Imagem</label><input type="text" id="edit-imageUrl-${item.id}" value="${Util.escapeHTML(item.imageUrl)}"></div>
        <div><label>Descrição</label><textarea id="edit-desc-${item.id}" rows="2">${Util.escapeHTML(item.desc || '')}</textarea></div>
        <div><label>Tags</label><input type="text" id="edit-tags-${item.id}" value="${Util.escapeHTML((item.tags || []).join(', '))}"></div>
        <div class="form-grid">
          <div><label>Pontuação</label><input type="number" step="0.1" min="0" max="10" id="edit-score-${item.id}" value="${Number(item.score || 0).toFixed(1)}"></div>
        </div>
        <div class="flex" style="margin-top:10px; justify-content: flex-end;">
          <button class="small btn-ghost" data-action="cancel-edit">Cancelar</button>
          <button class="small" data-action="save-edit" data-id="${item.id}">Salvar</button>
        </div>
      </div>`;
  }

  const tagsHTML = (item.tags || []).map(t => `<span class="tag">${Util.escapeHTML(t)}</span>`).join('');
  const bannerStyle = item.imageUrl ? `background-image: url('${Util.escapeHTML(item.imageUrl)}');` : `background-image: linear-gradient(45deg, rgba(var(--accent-rgb), 0.2), rgba(var(--secondary-rgb), 0.2));`;
  return `
    <div class="item" style="--i: ${item.renderIndex}" data-id="${item.id}">
      <div class="item-banner" style="${bannerStyle}"></div>
      <div class="item-content">
        <div class="item-header">
          <div class="name">${Util.escapeHTML(item.name)}</div>
          <div class="score-wrapper">
            <div class="score">${Number(item.score || 0).toFixed(1)}</div>
            <div class="score-votes">(${item.votes || 0} votos)</div>
          </div>
        </div>
        <div class="desc">${Util.escapeHTML(item.desc || '')}</div>
        <div class="item-footer">
          <div class="tags">${tagsHTML}</div>
          <div class="controls">
            <button data-action="vote-up" data-id="${item.id}" aria-label="Voto positivo"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 4l8 8h-6v8h-4v-8H4l8-8z"/></svg></button>
            <button data-action="vote-down" data-id="${item.id}" aria-label="Voto negativo"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 20l-8-8h6V4h4v8h6l-8 8z"/></svg></button>
            <button data-action="edit" data-id="${item.id}" aria-label="Editar"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83zM3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z"/></svg></button>
            <button data-action="delete" data-id="${item.id}" aria-label="Excluir"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></button>
          </div>
        </div>
      </div>
    </div>`;
}

function renderMain() {
  if (!currentCategoryId) {
    DOM.categoryTitle.textContent = 'Nenhuma categoria'; DOM.categoryCount.textContent = '0 itens';
    DOM.rankList.innerHTML = `<div style="grid-column: 1 / -1; text-align:center; padding: 40px 20px; color: var(--muted);">Selecione ou crie uma categoria para começar.</div>`;
    return;
  }
  const cat = state.categories.find(c => c.id === currentCategoryId);
  DOM.categoryTitle.textContent = cat?.name || '—';
  let items = App.getItemsForCategory(currentCategoryId);
  items.sort((a,b)=> (b.score||0) - (a.score||0));
  items.forEach((item, index) => item.renderIndex = index);
  DOM.categoryCount.textContent = `${items.length} itens`;
  DOM.rankList.innerHTML = items.length ? items.map(createItemHTML).join('') : `<div style="grid-column: 1 / -1; text-align:center; padding: 40px 20px; color: var(--muted);">Esta categoria está vazia. Adicione um item!</div>`;
  AppState.save();
}

function setupEventListeners() {
  DOM.createCatBtn.onclick = () => { App.createCategory(DOM.catNameInput.value.trim()); DOM.catNameInput.value = ''; };
  DOM.addItemBtn.onclick = () => {
    App.addItem(currentCategoryId, DOM.itemNameInput.value.trim(), DOM.itemImageUrlInput.value.trim(), DOM.itemDescInput.value.trim(), DOM.itemTagsInput.value);
    DOM.itemNameInput.value = ''; DOM.itemImageUrlInput.value = ''; DOM.itemDescInput.value = ''; DOM.itemTagsInput.value = ''; DOM.itemNameInput.focus();
  };
  DOM.rankList.addEventListener('click', e => {
    const target = e.target.closest('[data-action]');
    if (!target) return;
    const { action, id } = target.dataset;
    switch (action) {
      case 'vote-up': App.vote(id, 1); break;
      case 'vote-down': App.vote(id, -1); break;
      case 'edit': editingItemId = id; renderMain(); break;
      case 'delete': if(confirm('Excluir este item?')) App.deleteItem(id); break;
      case 'save-edit':
        const form = target.closest('.edit-form');
        App.updateItem(id, {
          name: form.querySelector(`#edit-name-${id}`).value,
          imageUrl: form.querySelector(`#edit-imageUrl-${id}`).value,
          desc: form.querySelector(`#edit-desc-${id}`).value,
          tags: App.formatTags(form.querySelector(`#edit-tags-${id}`).value),
          score: parseFloat(form.querySelector(`#edit-score-${id}`).value),
        });
        break;
      case 'cancel-edit': editingItemId = null; renderMain(); break;
    }
  });
  DOM.showChartBtn.onclick = () => {
    DOM.chartPanel.classList.remove('hidden');
    const items = App.getItemsForCategory(currentCategoryId).slice().sort((a,b)=> (b.score||0) - (a.score||0)).slice(0, 15);
    if(chartInstance) chartInstance.destroy();
    chartInstance = new Chart(DOM.scoreChartCanvas.getContext('2d'), {
      type:'bar', data: { labels: items.map(i => i.name), datasets:[{ label:'Pontuação', data: items.map(i => i.score), backgroundColor: 'rgba(139, 92, 246, 0.6)', borderColor: 'rgba(139, 92, 246, 1)', borderWidth: 1, borderRadius: 4 }]},
      options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, max: 10, ticks: { color: 'var(--muted)' }, grid: { color: 'rgba(255,255,255,0.1)' } }, x: { ticks: { color: 'var(--muted)' }, grid: { color: 'transparent' }} }, plugins: { legend: { display: false } } }
    });
  };
  DOM.closeChart.onclick = () => DOM.chartPanel.classList.add('hidden');
}

function boot() {
  AppState.load();
  if (!currentCategoryId && state.categories[0]) {
    currentCategoryId = state.categories[0].id;
  }
  renderCategories();
  setupEventListeners();
}
boot();
</script>
</body>
</html>